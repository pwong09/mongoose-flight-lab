<%- include('../partials/header') %> 
    <h3>Flight Details</h3>
    <section>
        <div><span>Airline:</span> <%= flight.airline %> </div>
        <div><span>Flight Number:</span> <%= flight.flightNo %> </div>
        <div><span>Departing from:</span> <%= flight.airport %> </div>
        <div><span>Departure Date & Time:</span> <%= flight.departs %> </div>
        <div><span>Meal Options:</span><br> 
            <% const theMeals = []; %> 
            <% flight.meals.forEach(m => { %>
                <% theMeals.push(m.theMeal) %> 
            <% }); %>
            <% uniqueMeals = [...new Set(theMeals)] %>
            <% uniqueMeals.forEach(m => { %>
                <form action="/meals/<%= flight._id %>?_method=DELETE" method="POST">
                <%= m %>  <input id="delete-meal" type="submit" value="remove" />
                </form>
            <% }); %>
        </div>
    <!-- destinations table-->
        <table id="sortable">
            <thead>
                <tr>
                    <th>Arrivals</th>
                    <th>Arrival Date</th> 
                    <th>Arrival Time</th>
                    <th></th>
                <tr>
            </thead>
            <tbody> 
                <% flight.destinations.sort(function (a, b) { %>
                    <% return a.arrivals - b.arrivals %>
                <% }); %> 
                <% flight.destinations.forEach(f => { %>
                <tr>
                    <td><%= f.airport.toString() %></td> 
                    <td><%= f.arrivals.toDateString() %></td>
                    <td><%= f.arrivals.toLocaleTimeString() %></td>
                    <td><form action="/destinations/<%= flight._id %>?_method=DELETE" method="POST">
                        <button type="submit">delete</button>
                    </form></td>
                </tr>
                <% }); %>  
            </tbody>
        </table>
    </section>
    <!--adding destination form-->
    <form method="POST" action="/flights/<%= flight._id %>/destinations">
        <label>Add a Destination:</label>
        <select name="airport">
            <% arrivalAirports.forEach(a => { %>
                <% const list = []; %> 
                <% a != flight.airport ? list.push(a) : null %>
                <% list.forEach(l => { %>
                            <option value="<%= l %>"><%= l %></option>
                <% }); %> 
            <% }); %> 
        </select><br>
        <label>Add an Arrival Date & Time</label><br>
        <input name="arrivals" type="datetime-local" value="<%= arrivalsDate %>"><br>
        <input class="button" type="submit" value="Add Destination" />
    </form>
    <!--adding a meals form form-->
    <form method="POST" action="/flights/<%= flight._id %>/meals">
        <label>Add a Meal: </label>
        <select name="theMeal">
            <% mealOptions.forEach(m => { %>
                <option value="<%= m %>"><%= m %></option>
            <% }); %>
        </select>
        <input class="button" type="submit" value="Add Meal" />
    </form>
    <br><br><br>
    <!--adding a delete form-->
    <form method="POST" action="/flights/<%= flight._id %>?_method=DELETE">
        <input class="button" type="submit" value="Delete Flight" />
    </form>
    <!--adding a meals form form-->
    <br><br><br>
    <a class="button" href="/flights">Back</a>
<%- include('../partials/footer') %> 
